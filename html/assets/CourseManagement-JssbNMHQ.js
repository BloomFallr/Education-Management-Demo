import{r as v,o as w,L as h,I as l,k as F,H as e,t as c,z as ae,j as oe,O as ne,w as ue,x as re,l as R,P as se}from"./index-CauhVxhf.js";import{E as L,a as N,b as de,c as ie,v as me}from"./el-message-box-72ezgMD2.js";import{E as pe,a as ce,b as ge}from"./el-main-1zPLywyB.js";import{E as fe}from"./el-pagination-tu8S2-45.js";import{E as j,a as O}from"./el-message-BlXH8VcA.js";import{E as ve,a as _e}from"./el-table-column-DDc4vDH_.js";import"./el-popper-CqdONIHR.js";import{E as be}from"./el-empty-DlBGokpv.js";import{E as ye}from"./el-progress-Dgvb9y-8.js";import{E as G,a as J}from"./el-form-item-C075O6SC.js";import{b as H,e as Ve}from"./constants-DWAz7ei8.js";import{E as Se}from"./el-dialog-B2TCSZSx.js";import"./el-overlay-IdPhgn1o.js";import{b as xe,c as Ee,d as we,e as Ce,f as he}from"./adm-M6jV_13o.js";import{E as D}from"./request-BnFEnbez.js";import"./aria-nkjrUMQ-.js";import"./focus-trap-CBJl3iZD.js";import"./index-r5W6hzzQ.js";import"./vnode-RFtRU_sW.js";const Ue={class:"dialog-footer"},ke={__name:"CourseEdit",emits:["success"],setup(A,{expose:z,emit:P}){const _=v(!1),U=P,a=v({id:"",classId:"",name:"",teacher:"",credit:"",selectedStudents:"",maxStudents:"",year:"",semester:"",time:"",place:""}),t={classId:[{required:!0,message:"请输入课堂号",trigger:"blur"},{min:1,max:10,message:"课堂号长度不超过10",trigger:"blur"}],name:[{required:!0,message:"请输入课程名称",trigger:"blur"},{min:1,max:15,message:"课程名称长度不超过15",trigger:"blur"}],teacher:[{required:!0,message:"请输入教师姓名",trigger:"blur"},{min:1,max:10,message:"教师姓名长度不超过10",trigger:"blur"}],credit:[{required:!0,message:"请输入学分",trigger:"blur"},{pattern:/^[1-9]\d*$/,message:"输入必须为非零整数"}],maxStudents:[{required:!0,message:"请输入人数上限",trigger:"blur"},{pattern:/^\d+$/,message:"输入必须为非负整数"},{validator:(b,o,d)=>{parseInt(o)<parseInt(a.value.selectedStudents)?d(new Error("人数上限不能少于已选人数")):d()},trigger:"blur"}],year:[{required:!0,message:"请输入学年",trigger:"blur"},{pattern:/^[1-9]\d*$/,message:"输入必须为非零整数"}],semester:[{required:!0,message:"请选择学期",trigger:"change"}],time:[{required:!0,message:"请输入上课时间",trigger:"change"},{min:1,max:50,message:"上课时间长度不超过50",trigger:"blur"},{validator:(b,o,d)=>{let i=/^周(一|二|三|四|五|六|日)第(\d+)到(\d+)节$/,V=/^周(一|二|三|四|五|六|日)第(\d+)节$/,S=o.split(",");for(let y=0;y<S.length;y++){let f=i.exec(S[y]),C=V.exec(S[y]);if(!f&&!C&&d(new Error("时间格式错误")),f){let r=parseInt(f[2]),u=parseInt(f[3]);(u<r||u>13)&&d(new Error("时间格式错误"))}else parseInt(C[2])>13&&d(new Error("时间格式错误"))}d()},trigger:"blur"}],place:[{required:!0,message:"请输入上课地点",trigger:"blur"},{min:1,max:15,message:"上课地点长度不超过15",trigger:"blur"}]};z({open:b=>{_.value=!0,a.value={...b},JSON.stringify(b)=="{}"&&(a.value.selectedStudents=0)}});const k=v(),q=()=>{k.value.clearValidate(),_.value=!1},B=async()=>{var o;await((o=k.value)==null?void 0:o.validate()),a.value.id?(await xe(a.value),D.success("编辑成功")):(await Ee(a.value),D.success("添加成功")),_.value=!1,U("success")};return(b,o)=>{const d=j,i=G,V=L,S=N,y=J,f=O,C=Se;return w(),h(C,{modelValue:_.value,"onUpdate:modelValue":o[10]||(o[10]=r=>_.value=r),title:a.value.id?"编辑课程":"添加课程",width:"500",draggable:"",overflow:""},{footer:l(()=>[F("div",Ue,[e(f,{onClick:q},{default:l(()=>[c("取消")]),_:1}),e(f,{type:"primary",onClick:B},{default:l(()=>[c("确认")]),_:1})])]),default:l(()=>[e(y,{ref_key:"formRef",ref:k,model:a.value,rules:t,"label-width":"100px",style:{"padding-right":"30px"}},{default:l(()=>[e(i,{label:"课堂号",prop:"classId"},{default:l(()=>[e(d,{placeholder:"请输入课堂号",modelValue:a.value.classId,"onUpdate:modelValue":o[0]||(o[0]=r=>a.value.classId=r)},null,8,["modelValue"])]),_:1}),e(i,{label:"课程名称",prop:"name"},{default:l(()=>[e(d,{placeholder:"请输入课程名称",modelValue:a.value.name,"onUpdate:modelValue":o[1]||(o[1]=r=>a.value.name=r)},null,8,["modelValue"])]),_:1}),e(i,{label:"授课老师",prop:"teacher"},{default:l(()=>[e(d,{placeholder:"请输入教师姓名",modelValue:a.value.teacher,"onUpdate:modelValue":o[2]||(o[2]=r=>a.value.teacher=r)},null,8,["modelValue"])]),_:1}),e(i,{label:"学分",prop:"credit"},{default:l(()=>[e(d,{placeholder:"请输入学分",modelValue:a.value.credit,"onUpdate:modelValue":o[3]||(o[3]=r=>a.value.credit=r)},null,8,["modelValue"])]),_:1}),e(i,{label:"学年",prop:"year"},{default:l(()=>[e(d,{placeholder:"请输入学年",modelValue:a.value.year,"onUpdate:modelValue":o[4]||(o[4]=r=>a.value.year=r)},null,8,["modelValue"])]),_:1}),e(i,{label:"学期",prop:"semester"},{default:l(()=>[e(S,{modelValue:a.value.semester,"onUpdate:modelValue":o[5]||(o[5]=r=>a.value.semester=r),placeholder:"学期",clearable:""},{default:l(()=>[e(V,{label:"春季学期",value:"春季学期"}),e(V,{label:"夏季学期",value:"夏季学期"}),e(V,{label:"秋季学期",value:"秋季学期"})]),_:1},8,["modelValue"])]),_:1}),e(i,{label:"上课时间",prop:"time"},{default:l(()=>[e(d,{placeholder:"请输入上课时间",modelValue:a.value.time,"onUpdate:modelValue":o[6]||(o[6]=r=>a.value.time=r)},null,8,["modelValue"])]),_:1}),e(i,{label:"上课地点",prop:"place"},{default:l(()=>[e(d,{placeholder:"请输入上课地点",modelValue:a.value.place,"onUpdate:modelValue":o[7]||(o[7]=r=>a.value.place=r)},null,8,["modelValue"])]),_:1}),e(i,{label:"已选人数",prop:"selectedStudents"},{default:l(()=>[e(d,{disabled:"",modelValue:a.value.selectedStudents,"onUpdate:modelValue":o[8]||(o[8]=r=>a.value.selectedStudents=r)},null,8,["modelValue"])]),_:1}),e(i,{label:"人数上限",prop:"maxStudents"},{default:l(()=>[e(d,{placeholder:"请输入人数上限",modelValue:a.value.maxStudents,"onUpdate:modelValue":o[9]||(o[9]=r=>a.value.maxStudents=r)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}},Ie={style:{color:"black"}},Qe={__name:"CourseManagement",setup(A){const z=v([]),P=v(0),_=v([]),U=v(),a=v(!1),t=v({name:"",teacher:"",year:"",semester:"",time:"",place:"",selectState:"",courseState:"",pageSize:10,currentPage:1}),g=async()=>{a.value=!0;const u=await we(t.value);z.value=u.data.data.list,P.value=u.data.data.total,a.value=!1},k=()=>{t.value.currentPage=1,g()},q=()=>{t.value.currentPage=1,t.value.name="",t.value.teacher="",t.value.year="",t.value.semester="",t.value.time="",t.value.place="",t.value.selectState="",t.value.courseState="",g()};ae(()=>{g()});const B=u=>{t.value.currentPage=u,g()},b=u=>{t.value.pageSize=u,g()},o=u=>{_.value=u.map(s=>s.id)},d=async u=>{await Ce(_.value.join(","),u),g()},i=u=>{U.value.open(u)},V=()=>{U.value.open({})},S=async u=>{await de.confirm("您确认删除该课程吗？","温馨提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning",icon:se(H)}).then(async()=>{await he(u.id),D.success("删除成功"),g()})},y=()=>{g()},f=u=>parseInt((u.selectedStudents/u.maxStudents).toFixed(1)*100),C=u=>u.selectedStudents===u.maxStudents?"exception":"success",r=u=>u.selectedStudents+"/"+u.maxStudents;return(u,s)=>{const I=j,m=G,x=L,T=N,E=O,M=J,K=ce,p=ve,Q=ye,$=ie,W=be,X=_e,Y=fe,Z=ge,ee=pe,le=me;return w(),oe(ne,null,[e(ee,null,{default:l(()=>[e(K,null,{default:l(()=>[e(M,{inline:""},{default:l(()=>[e(m,null,{default:l(()=>[e(I,{modelValue:t.value.name,"onUpdate:modelValue":s[0]||(s[0]=n=>t.value.name=n),placeholder:"课程名称",style:{width:"125px"}},null,8,["modelValue"])]),_:1}),e(m,null,{default:l(()=>[e(I,{modelValue:t.value.teacher,"onUpdate:modelValue":s[1]||(s[1]=n=>t.value.teacher=n),placeholder:"任课教师",style:{width:"125px"}},null,8,["modelValue"])]),_:1}),e(m,null,{default:l(()=>[e(I,{modelValue:t.value.year,"onUpdate:modelValue":s[2]||(s[2]=n=>t.value.year=n),placeholder:"学年",style:{width:"125px"}},null,8,["modelValue"])]),_:1}),e(m,null,{default:l(()=>[e(T,{modelValue:t.value.semester,"onUpdate:modelValue":s[3]||(s[3]=n=>t.value.semester=n),placeholder:"学期",style:{width:"125px"},clearable:""},{default:l(()=>[e(x,{label:"春季学期",value:"春季学期"}),e(x,{label:"夏季学期",value:"夏季学期"}),e(x,{label:"秋季学期",value:"秋季学期"})]),_:1},8,["modelValue"])]),_:1}),e(m,null,{default:l(()=>[e(I,{modelValue:t.value.time,"onUpdate:modelValue":s[4]||(s[4]=n=>t.value.time=n),placeholder:"时间",style:{width:"125px"}},null,8,["modelValue"])]),_:1}),e(m,null,{default:l(()=>[e(I,{modelValue:t.value.place,"onUpdate:modelValue":s[5]||(s[5]=n=>t.value.place=n),placeholder:"地点",style:{width:"125px"}},null,8,["modelValue"])]),_:1}),e(m,null,{default:l(()=>[e(T,{modelValue:t.value.selectState,"onUpdate:modelValue":s[6]||(s[6]=n=>t.value.selectState=n),placeholder:"选课状态",style:{width:"125px"},clearable:""},{default:l(()=>[e(x,{label:"选课未结束",value:"1"}),e(x,{label:"选课已结束",value:"0"})]),_:1},8,["modelValue"])]),_:1}),e(m,null,{default:l(()=>[e(T,{modelValue:t.value.courseState,"onUpdate:modelValue":s[7]||(s[7]=n=>t.value.courseState=n),placeholder:"课程状态",style:{width:"125px"},clearable:""},{default:l(()=>[e(x,{label:"未结课",value:"1"}),e(x,{label:"已结课",value:"0"})]),_:1},8,["modelValue"])]),_:1}),e(m,{style:{float:"inline-end"}},{default:l(()=>[e(E,{type:"primary",onClick:q,round:"",plain:"",style:{width:"30"}},{default:l(()=>[c("重置")]),_:1})]),_:1}),e(m,{style:{float:"inline-end"}},{default:l(()=>[e(E,{type:"primary",onClick:k,round:"",plain:"",style:{width:"30"}},{default:l(()=>[c("搜索")]),_:1})]),_:1})]),_:1})]),_:1}),e(Z,null,{default:l(()=>[ue((w(),h(X,{data:z.value,border:"",style:{width:"100%"},height:"580px",onSelectionChange:o},{empty:l(()=>[e(W,{description:"没有数据"})]),default:l(()=>[e(p,{type:"selection",width:"55",fixed:"left"}),e(p,{prop:"classId",label:"课堂号",width:"160"}),e(p,{prop:"name",label:"课程名称",width:"160"}),e(p,{prop:"teacher",label:"授课老师",width:"150"}),e(p,{prop:"credit",label:"学分",width:"75"}),e(p,{prop:"year",label:"学年",width:"100"}),e(p,{prop:"semester",label:"学期",width:"150"}),e(p,{prop:"time",label:"上课时间",width:"300"}),e(p,{prop:"place",label:"上课地点",width:"100"}),e(p,{label:"已选/人数上限",width:"200"},{default:l(({row:n})=>[e(Q,{"text-inside":!0,"stroke-width":18,percentage:f(n),status:C(n)},{default:l(()=>[F("span",Ie,re(r(n)),1)]),_:2},1032,["percentage","status"])]),_:1}),e(p,{label:"状态",width:"160"},{default:l(({row:n})=>[n.selectState==1?(w(),h($,{key:0,type:"success",round:""},{default:l(()=>[c("正在选课")]),_:1})):(w(),h($,{key:1,type:"warning",round:""},{default:l(()=>[c("选课结束")]),_:1})),n.courseState==1?(w(),h($,{key:2,type:"success",round:""},{default:l(()=>[c("正在上课")]),_:1})):(w(),h($,{key:3,type:"warning",round:""},{default:l(()=>[c("课程结束")]),_:1}))]),_:1}),e(p,{fixed:"right",label:"操作",width:"85"},{default:l(({row:n})=>[e(E,{size:"small",type:"primary",onClick:te=>i(n),icon:R(Ve),circle:"",plain:""},null,8,["onClick","icon"]),e(E,{size:"small",type:"danger",onClick:te=>S(n),icon:R(H),circle:"",plain:""},null,8,["onClick","icon"])]),_:1})]),_:1},8,["data"])),[[le,a.value]]),e(M,{inline:"",style:{"margin-top":"10px","text-align":"right"}},{default:l(()=>[e(m,null,{default:l(()=>[e(E,{type:"success",onClick:s[8]||(s[8]=n=>d(1)),plain:""},{default:l(()=>[c("开放选课")]),_:1})]),_:1}),e(m,null,{default:l(()=>[e(E,{type:"success",onClick:s[9]||(s[9]=n=>d(0)),plain:""},{default:l(()=>[c("结束选课")]),_:1})]),_:1}),e(m,null,{default:l(()=>[e(E,{type:"primary",onClick:V,plain:""},{default:l(()=>[c("添加课程")]),_:1})]),_:1}),e(m,null,{default:l(()=>[e(Y,{"current-page":t.value.currentPage,"onUpdate:currentPage":s[10]||(s[10]=n=>t.value.currentPage=n),"page-size":t.value.pageSize,"onUpdate:pageSize":s[11]||(s[11]=n=>t.value.pageSize=n),background:!0,"page-sizes":[10,15,20,25],layout:"sizes, total, prev, pager, next, jumper",total:P.value,onCurrentChange:B,onSizeChange:b},null,8,["current-page","page-size","total"])]),_:1})]),_:1})]),_:1})]),_:1}),e(ke,{ref_key:"courseEditRef",ref:U,onSuccess:y},null,512)],64)}}};export{Qe as default};
